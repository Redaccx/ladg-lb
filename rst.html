<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant POS Pro</title>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4;}
.header{background:#111;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
.container{display:flex;height:90vh;}
.products{width:65%;padding:10px;}
.categories{display:flex;gap:5px;margin-bottom:10px;flex-wrap:wrap;}
.categories button{padding:10px;background:#ff9800;border:none;color:white;cursor:pointer;font-weight:bold;}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.product-box{background:#4CAF50;color:white;padding:10px;text-align:center;border-radius:8px;}
.product-btn{width:100%;padding:10px;background:transparent;border:none;color:white;font-size:14px;cursor:pointer;}
.cart{width:35%;background:white;padding:10px;border-left:2px solid #ddd;display:flex;flex-direction:column;}
.cart-items{flex:1;overflow:auto;}
.total{font-weight:bold;margin-top:5px;}
button{padding:8px;margin-top:5px;border:none;color:white;cursor:pointer;}
.print{background:#2196F3;}
.clear{background:#e53935;}
.logout{background:#e53935;}
.login-box{max-width:320px;margin:100px auto;background:white;padding:20px;border-radius:10px;text-align:center;}
input{padding:8px;margin:5px 0;width:100%;}
</style>
</head>

<body>

<div id="loginPage" class="login-box">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="posSystem" style="display:none;">
<div class="header">
<div id="userInfo"></div>
<button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="container">

<div class="products">
<div class="categories" id="categories"></div>
<div class="grid" id="productGrid"></div>
</div>

<div class="cart">
<h3>Ø§Ù„Ø·Ù„Ø¨</h3>
<div class="cart-items" id="cartItems"></div>
<div class="total" id="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0</div>
<button class="print" onclick="saveOrder()">Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨</button>
<button class="clear" onclick="clearCart()">Ù…Ø³Ø­</button>
</div>

</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant POS Pro</title>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4;}
.header{background:#111;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
.container{display:flex;height:90vh;}
.products{width:65%;padding:10px;}
.categories{display:flex;gap:5px;margin-bottom:10px;flex-wrap:wrap;}
.categories button{padding:10px;background:#ff9800;border:none;color:white;cursor:pointer;font-weight:bold;}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.product-box{background:#4CAF50;color:white;padding:10px;text-align:center;border-radius:8px;}
.product-btn{width:100%;padding:10px;background:transparent;border:none;color:white;font-size:14px;cursor:pointer;}
.cart{width:35%;background:white;padding:10px;border-left:2px solid #ddd;display:flex;flex-direction:column;}
.cart-items{flex:1;overflow:auto;}
.total{font-weight:bold;margin-top:5px;}
button{padding:8px;margin-top:5px;border:none;color:white;cursor:pointer;}
.print{background:#2196F3;}
.clear{background:#e53935;}
.logout{background:#e53935;}
.login-box{max-width:320px;margin:100px auto;background:white;padding:20px;border-radius:10px;text-align:center;}
input{padding:8px;margin:5px 0;width:100%;}
</style>
</head>

<body>

<div id="loginPage" class="login-box">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="posSystem" style="display:none;">
<div class="header">
<div id="userInfo"></div>
<button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="container">

<div class="products">
<div class="categories" id="categories"></div>
<div class="grid" id="productGrid"></div>
</div>

<div class="cart">
<h3>Ø§Ù„Ø·Ù„Ø¨</h3>
<div class="cart-items" id="cartItems"></div>
<div class="total" id="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0</div>
<button class="print" onclick="saveOrder()">Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨</button>
<button class="clear" onclick="clearCart()">Ù…Ø³Ø­</button>
</div>

</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let role = "";
let products = {};
let cart = [];

// ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø±Ø³Ù…ÙŠ
async function login(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  try{
    const userCredential = await auth.signInWithEmailAndPassword(email,password);
    currentUser = userCredential.user;

    const userDoc = await db.collection("users").doc(currentUser.uid).get();
    role = userDoc.data().role;

    document.getElementById("userInfo").innerText =
      currentUser.email + " | Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: " + role;

    document.getElementById("loginPage").style.display="none";
    document.getElementById("posSystem").style.display="block";

    await loadCategories();
    await loadProducts();

  }catch(e){
    alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
  }
}

// ğŸ”“ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
function logout(){
  auth.signOut();
  location.reload();
}

// ğŸ“‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
async function loadCategories(){
  const div=document.getElementById("categories");
  div.innerHTML="";
  const snap=await db.collection("categories").get();
  snap.forEach(doc=>{
    const cat=doc.data().name;
    div.innerHTML+=`<button onclick="showProducts('${cat}')">${cat}</button>`;
  });
}

// ğŸ“¦ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
async function loadProducts(){
  products={};
  const snap=await db.collection("products").get();
  snap.forEach(doc=>{
    const d=doc.data();
    if(!products[d.category]) products[d.category]=[];
    products[d.category].push(d);
  });
}

function showProducts(cat){
  const grid=document.getElementById("productGrid");
  grid.innerHTML="";
  if(!products[cat]) return;

  products[cat].forEach(p=>{
    grid.innerHTML+=`
      <div class="product-box">
        <button class="product-btn" onclick="addToCart('${p.name}',${p.price})">
          ${p.name}<br>${p.price}
        </button>
      </div>`;
  });
}

function addToCart(name,price){
  cart.push({name,price});
  renderCart();
}

function renderCart(){
  const div=document.getElementById("cartItems");
  div.innerHTML="";
  let total=0;
  cart.forEach((item,i)=>{
    div.innerHTML+=`${item.name} - ${item.price}
      <button onclick="removeItem(${i})">âŒ</button><br>`;
    total+=item.price;
  });
  document.getElementById("total").innerText="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: "+total;
}

function removeItem(i){ cart.splice(i,1); renderCart(); }
function clearCart(){ cart=[]; renderCart(); }

// ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨
async function saveOrder(){
  if(cart.length===0) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨");

  let total=cart.reduce((sum,item)=>sum+item.price,0);

  await db.collection("sales").add({
    user: currentUser.uid,
    email: currentUser.email,
    role: role,
    total: total,
    items: cart,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨");
  clearCart();
}
</script>

</body>
</html>
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let role = "";
let products = {};
let cart = [];

// ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø±Ø³Ù…ÙŠ
async function login(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  try{
    const userCredential = await auth.signInWithEmailAndPassword(email,password);
    currentUser = userCredential.user;

    const userDoc = await db.collection("users").doc(currentUser.uid).get();
    role = userDoc.data().role;

    document.getElementById("userInfo").innerText =
      currentUser.email + " | Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: " + role;

    document.getElementById("loginPage").style.display="none";
    document.getElementById("posSystem").style.display="block";

    await loadCategories();
    await loadProducts();

  }catch(e){
    alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
  }
}

// ğŸ”“ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
function logout(){
  auth.signOut();
  location.reload();
}

// ğŸ“‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
async function loadCategories(){
  const div=document.getElementById("categories");
  div.innerHTML="";
  const snap=await db.collection("categories").get();
  snap.forEach(doc=>{
    const cat=doc.data().name;
    div.innerHTML+=`<button onclick="showProducts('${cat}')">${cat}</button>`;
  });
}

// ğŸ“¦ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
async function loadProducts(){
  products={};
  const snap=await db.collection("products").get();
  snap.forEach(doc=>{
    const d=doc.data();
    if(!products[d.category]) products[d.category]=[];
    products[d.category].push(d);
  });
}

function showProducts(cat){
  const grid=document.getElementById("productGrid");
  grid.innerHTML="";
  if(!products[cat]) return;

  products[cat].forEach(p=>{
    grid.innerHTML+=`
      <div class="product-box">
        <button class="product-btn" onclick="addToCart('${p.name}',${p.price})">
          ${p.name}<br>${p.price}
        </button>
      </div>`;
  });
}

function addToCart(name,price){
  cart.push({name,price});
  renderCart();
}

function renderCart(){
  const div=document.getElementById("cartItems");
  div.innerHTML="";
  let total=0;
  cart.forEach((item,i)=>{
    div.innerHTML+=`${item.name} - ${item.price}
      <button onclick="removeItem(${i})">âŒ</button><br>`;
    total+=item.price;
  });
  document.getElementById("total").innerText="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: "+total;
}

function removeItem(i){ cart.splice(i,1); renderCart(); }
function clearCart(){ cart=[]; renderCart(); }

// ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨
async function saveOrder(){
  if(cart.length===0) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨");

  let total=cart.reduce((sum,item)=>sum+item.price,0);

  await db.collection("sales").add({
    user: currentUser.uid,
    email: currentUser.email,
    role: role,
    total: total,
    items: cart,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨");
  clearCart();
}
</script>

</body>
</html>
