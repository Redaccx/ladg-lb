<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant POS Pro</title>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4;}
.header{background:#111;color:white;padding:15px;text-align:center;font-size:20px;}
.container{display:flex;height:90vh;}
.products{width:65%;padding:10px;}
.categories{display:flex;gap:5px;margin-bottom:10px;}
.categories button{flex:1;padding:10px;background:#ff9800;border:none;color:white;cursor:pointer;font-weight:bold;}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.product-box{background:#4CAF50;color:white;padding:10px;text-align:center;}
.product-box button{margin-top:5px;padding:5px;font-size:12px;border:none;cursor:pointer;}
.edit-btn{background:#607d8b;color:white;}
.product-btn{width:100%;padding:10px;background:transparent;border:none;color:white;font-size:14px;cursor:pointer;}
.cart{width:35%;background:white;padding:10px;border-left:2px solid #ddd;display:flex;flex-direction:column;}
.cart-items{flex:1;overflow:auto;font-size:14px;}
.total{font-weight:bold;margin-top:5px;}
button{padding:8px;margin-top:5px;border:none;color:white;cursor:pointer;}
.print{background:#2196F3;}
.clear{background:#e53935;}
.report{background:#9c27b0;}
.login-box{max-width:300px;margin:100px auto;background:white;padding:20px;border-radius:10px;text-align:center;}
input,select{padding:5px;margin:5px 0;width:100%;}
@media print{
body *{visibility:hidden;}
#invoice,#invoice *{visibility:visible;}
#invoice{position:absolute;left:0;top:0;width:58mm;font-size:12px;}
}
</style>
</head>

<body>

<div id="loginPage" class="login-box">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h3>
<input type="text" id="cashierName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="posSystem" style="display:none;">
<div class="header">Ù†Ø¸Ø§Ù… Ù…Ø·Ø¹Ù… Ø§Ø­ØªØ±Ø§ÙÙŠ</div>
<div class="container">

<div class="products">
<div class="categories" id="categories"></div>
<div class="grid" id="productGrid"></div>
<button onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
</div>

<div class="cart">
<h3>Ø§Ù„Ø·Ù„Ø¨</h3>
<div class="cart-items" id="cartItems"></div>
<div class="total" id="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0</div>

<select id="paymentMethod">
<option>ÙƒØ§Ø´</option>
<option>ÙÙŠØ²Ø§</option>
</select>

<button class="print" onclick="printInvoice()">Ø·Ø¨Ø§Ø¹Ø©</button>
<button class="clear" onclick="clearCart()">Ù…Ø³Ø­</button>
<button class="report" onclick="dailyReport()">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
</div>

</div>
</div>

<div id="invoice" style="display:none;"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ğŸ”¹ Ø¶Ø¹ Ù‡Ù†Ø§ Firebase config Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
const firebaseConfig = {
  apiKey: "AIzaSyBQBGGtON-RNk4qH2Pws3RBBBE3cH3J4PU",
  authDomain: "store-app-d05fa.firebaseapp.com",
  projectId: "store-app-d05fa",
  storageBucket: "store-app-d05fa.firebasestorage.app",
  messagingSenderId: "257385912042",
  appId: "1:257385912042:web:bc30397b745340e31e2993"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
let products={
"Ø³Ù†Ø¯ÙˆÙŠØ´Ø§Øª":[{name:"Ø´Ø§ÙˆØ±Ù…Ø§ Ø¯Ø¬Ø§Ø¬",price:15},{name:"Ø´Ø§ÙˆØ±Ù…Ø§ Ù„Ø­Ù…",price:18}],
"ÙˆØ¬Ø¨Ø§Øª":[{name:"ÙˆØ¬Ø¨Ø© Ø¨Ø±ØºØ±",price:25}],
"Ù…Ø´Ø±ÙˆØ¨Ø§Øª":[{name:"Ø¨ÙŠØ¨Ø³ÙŠ",price:5}],
"Ø£Ø±Ø§ÙƒÙŠÙ„":[{name:"Ø£Ø±ÙƒÙŠÙ„Ø© ØªÙØ§Ø­ØªÙŠÙ†",price:20}],
"Ù„Ø­ÙˆÙ…":[{name:"Ù„Ø­Ù… ØºÙ†Ù…",price:0}]
};

let currentCategory="Ø³Ù†Ø¯ÙˆÙŠØ´Ø§Øª";
let cart=[];
let cashier="";

// ğŸ”¹ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ùˆ PIN
async function login() {
  const cashierName = document.getElementById("cashierName").value;
  const cashierPin = prompt("Ø§Ø¯Ø®Ù„ Ø±Ù…Ø² PIN:");
  if(!cashierName || !cashierPin){ alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù…Ø²"); return; }

  try {
    const snapshot = await db.collection("cashiers")
                             .where("name","==",cashierName)
                             .where("pin","==",cashierPin)
                             .get();
    if(snapshot.empty){ alert("Ø§Ø³Ù… Ø£Ùˆ Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­"); return; }

    cashier = cashierName;
    document.getElementById("loginPage").style.display="none";
    document.getElementById("posSystem").style.display="block";

    loadCategories();
    showProducts(currentCategory);
  } catch(e){ console.error(e); alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"); }
}

// ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
function loadCategories(){
  const categoriesDiv = document.getElementById("categories");
  categoriesDiv.innerHTML="";
  for(let cat in products){
    categoriesDiv.innerHTML+=`<button onclick="showProducts('${cat}')">${cat}</button>`;
  }
}

// ğŸ”¹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function showProducts(cat){
  currentCategory=cat;
  const productGrid = document.getElementById("productGrid");
  productGrid.innerHTML="";
  products[cat].forEach((p,i)=>{
    productGrid.innerHTML+=`
    <div class="product-box">
      <button class="product-btn" onclick="addToCart(${i})">${p.name}<br>${p.price>0?p.price:"Ø­Ø¯Ø¯ Ø§Ù„Ø³Ø¹Ø±"}</button>
      <button class="edit-btn" onclick="editProduct(${i})">âœ ØªØ¹Ø¯ÙŠÙ„</button>
    </div>`;
  });
}

// ğŸ”¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
function editProduct(index){
  let p=products[currentCategory][index];
  let newName=prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯:",p.name);
  let newPrice=parseFloat(prompt("Ø³Ø¹Ø± Ø¬Ø¯ÙŠØ¯:",p.price));
  if(!newName || isNaN(newPrice)) return;
  p.name=newName;
  p.price=newPrice;
  showProducts(currentCategory);
}

// ğŸ”¹ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ù„Ø¨
function addToCart(index){
  let p=products[currentCategory][index];
  let qty=1;
  let price=p.price;

  if(currentCategory==="Ù„Ø­ÙˆÙ…"){
    qty=parseFloat(prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ:"));
    price=parseFloat(prompt("Ø§Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„Ùˆ:"));
    if(!qty||!price)return;
  }

  let totalItem=qty*price;
  cart.push({name:p.name,qty,price,totalItem});
  renderCart();
}

// ğŸ”¹ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨
function renderCart(){
  const cartItems = document.getElementById("cartItems");
  let totalAmount=0;
  cartItems.innerHTML="";
  cart.forEach((item,i)=>{
    cartItems.innerHTML+=`${item.name} Ã— ${item.qty} = ${item.totalItem} <button onclick="removeItem(${i})">âŒ</button><br>`;
    totalAmount+=item.totalItem;
  });
  document.getElementById("total").innerText="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: "+totalAmount;
}

// ğŸ”¹ Ø¥Ø²Ø§Ù„Ø© Ù…Ù†ØªØ¬
function removeItem(i){ cart.splice(i,1); renderCart(); }
function clearCart(){ cart=[]; renderCart(); }

// ğŸ”¹ ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
function generateCode(){ return Math.random().toString(36).substring(2,6).toUpperCase(); }

// ğŸ”¹ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Firestore Ù…Ø¹ Ø±Ù‚Ù… Ø·Ù„Ø¨ Ù…ØªØªØ§Ø¨Ø¹
async function printInvoice(){
  if(cart.length===0){alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨"); return;}
  let total=0;
  let code=generateCode();
  let payment=document.getElementById("paymentMethod").value;

  // ğŸ”¹ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ Ù…Ù† Firestore
  let orderDoc = db.collection("counters").doc("orders");
  let orderSnapshot = await orderDoc.get();
  let orderNumber = 1;
  if(orderSnapshot.exists){
    orderNumber = orderSnapshot.data().lastOrder + 1;
  }

  // ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Firestore
  await orderDoc.set({ lastOrder: orderNumber });

  let html=`<div style="text-align:center">
<h3>Ù…Ø·Ø¹Ù… Ø§Ù„Ø³Ù†Ø¯ÙˆÙŠØ´Ø§Øª</h3>
<p>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${orderNumber}</p>
<p>Ø§Ù„ÙƒÙˆØ¯: ${code}</p>
<p>Ø§Ù„ÙƒØ§Ø´ÙŠØ±: ${cashier}</p>
<hr>`;

  cart.forEach(item => { html+=`<p>${item.name} Ã— ${item.qty} = ${item.totalItem}</p>`; total+=item.totalItem; });

  html+=`<hr><h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total}</h4><p>Ø§Ù„Ø¯ÙØ¹: ${payment}</p><p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…</p></div>`;
  document.getElementById("invoice").innerHTML=html;
  document.getElementById("invoice").style.display="block";

  try{
    await db.collection("sales").add({
      cashier,
      orderNumber,
      code,
      total,
      payment,
      items: cart,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  } catch(e){ console.error(e); alert("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©"); }

  window.print();
  clearCart();
}

// ğŸ”¹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…
async function dailyReport(){
  const today = new Date(); today.setHours(0,0,0,0);
  try{
    const snapshot = await db.collection("sales").where("timestamp", ">=", today).get();
    let sum=0;
    snapshot.forEach(doc => sum += doc.data().total);
    alert("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…: " + sum);
  } catch(e){ console.error(e); alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…"); }
}

// ğŸ”¹ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
function addProduct(){
  let name=prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:");
  let price=parseFloat(prompt("Ø§Ù„Ø³Ø¹Ø±:"));
  if(!name||isNaN(price))return;
  products[currentCategory].push({name,price});
  showProducts(currentCategory);
}
</script>

</body>
</html>
