<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant POS Pro</title>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4;}
.header{background:#111;color:white;padding:15px;font-size:18px;display:flex;justify-content:space-between;align-items:center;}
.container{display:flex;height:90vh;}
.products{width:65%;padding:10px;}
.categories{display:flex;gap:5px;margin-bottom:10px;flex-wrap:wrap;}
.categories button{padding:10px;background:#ff9800;border:none;color:white;cursor:pointer;font-weight:bold;}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.product-box{background:#4CAF50;color:white;padding:10px;text-align:center;border-radius:8px;}
.product-box button{margin-top:5px;padding:5px;font-size:12px;border:none;cursor:pointer;}
.edit-btn{background:#607d8b;color:white;}
.delete-btn{background:#e53935;color:white;}
.product-btn{width:100%;padding:10px;background:transparent;border:none;color:white;font-size:14px;cursor:pointer;}
.cart{width:35%;background:white;padding:10px;border-left:2px solid #ddd;display:flex;flex-direction:column;}
.cart-items{flex:1;overflow:auto;font-size:14px;}
.total{font-weight:bold;margin-top:5px;}
button{padding:8px;margin-top:5px;border:none;color:white;cursor:pointer;}
.print{background:#2196F3;}
.clear{background:#e53935;}
.report{background:#9c27b0;}
.shift{background:#ff5722;}
.logout{background:#e53935;}
.login-box{max-width:320px;margin:100px auto;background:white;padding:20px;border-radius:10px;text-align:center;}
input,select{padding:8px;margin:5px 0;width:100%;font-size:14px;}
@media print{
body *{visibility:hidden;}
#invoice,#invoice *{visibility:visible;}
#invoice{position:absolute;left:0;top:0;width:58mm;font-size:12px;}
}
</style>
</head>

<body>

<div id="loginPage" class="login-box">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
<input type="text" id="cashierName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
<input type="password" id="cashierPin" placeholder="PIN">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="posSystem" style="display:none;">
<div class="header">
<div id="cashierDisplay"></div>
<button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="container">

<div class="products">
<div class="categories" id="categories"></div>
<div class="grid" id="productGrid"></div>
</div>

<div class="cart">
<h3>Ø§Ù„Ø·Ù„Ø¨</h3>
<div class="cart-items" id="cartItems"></div>
<div class="total" id="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0</div>

<select id="paymentMethod">
<option>ÙƒØ§Ø´</option>
<option>ÙÙŠØ²Ø§</option>
</select>

<button class="print" onclick="printInvoice()">Ø·Ø¨Ø§Ø¹Ø©</button>
<button class="clear" onclick="clearCart()">Ù…Ø³Ø­</button>
<button class="report" onclick="dailyReport()">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
<button class="shift" onclick="closeShift()">Ø¥ØºÙ„Ø§Ù‚ Ø´ÙŠÙØª</button>
</div>

</div>
</div>

<div id="invoice" style="display:none;"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let products = {};
let currentCategory = "";
let cart = [];
let cashier = "";
let role = "";
let shiftStart;

// ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø¶Ø¨ÙˆØ·
async function login(){
  const name = document.getElementById("cashierName").value.trim();
  const pin = document.getElementById("cashierPin").value.trim();

  if(!name || !pin) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù€ PIN");

  const snap = await db.collection("cashiers")
    .where("name","==",name)
    .get();

  if(snap.empty) return alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

  const data = snap.docs[0].data();

  if(String(data.pin) !== pin)
    return alert("PIN ØºÙŠØ± ØµØ­ÙŠØ­");

  cashier = data.name;
  role = data.role;
  shiftStart = new Date();

  document.getElementById("cashierDisplay").innerText =
    "Ø§Ù„Ù…ÙˆØ¸Ù: "+cashier+" | Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: "+role;

  document.getElementById("loginPage").style.display="none";
  document.getElementById("posSystem").style.display="block";

  await loadCategories();
  await loadProducts();
}

// ğŸ”“ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
function logout(){
  cashier="";
  role="";
  cart=[];
  document.getElementById("posSystem").style.display="none";
  document.getElementById("loginPage").style.display="block";
  document.getElementById("cashierName").value="";
  document.getElementById("cashierPin").value="";
}

// ğŸ“‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
async function loadCategories(){
  const div=document.getElementById("categories");
  div.innerHTML="";
  const snap=await db.collection("categories").get();
  snap.forEach(doc=>{
    const cat=doc.data().name;
    div.innerHTML+=`<button onclick="showProducts('${cat}')">${cat}</button>`;
  });
}

// ğŸ“¦ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
async function loadProducts(){
  products={};
  const snap=await db.collection("products").get();
  snap.forEach(doc=>{
    const d=doc.data();
    if(!products[d.category]) products[d.category]=[];
    products[d.category].push({id:doc.id,name:d.name,price:d.price});
  });
}

// ğŸ›’ Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª
function showProducts(cat){
  currentCategory=cat;
  const grid=document.getElementById("productGrid");
  grid.innerHTML="";
  if(!products[cat]) return;

  products[cat].forEach((p,i)=>{
    grid.innerHTML+=`
    <div class="product-box">
      <button class="product-btn" onclick="addToCart(${i})">
      ${p.name}<br>${p.price}
      </button>
    </div>`;
  });
}

function addToCart(i){
  let p=products[currentCategory][i];
  cart.push({name:p.name,qty:1,price:p.price,total:p.price});
  renderCart();
}

function renderCart(){
  let div=document.getElementById("cartItems");
  div.innerHTML="";
  let total=0;
  cart.forEach((item,i)=>{
    div.innerHTML+=`${item.name} = ${item.total} 
    <button onclick="removeItem(${i})">âŒ</button><br>`;
    total+=item.total;
  });
  document.getElementById("total").innerText="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: "+total;
}

function removeItem(i){ cart.splice(i,1); renderCart(); }
function clearCart(){ cart=[]; renderCart(); }

function generateCode(){
  return Math.random().toString(36).substring(2,6).toUpperCase();
}

async function printInvoice(){
  if(cart.length===0) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨");

  let total=0;
  let payment=document.getElementById("paymentMethod").value;
  let code=generateCode();

  let counterRef=db.collection("counters").doc("orders");
  let snap=await counterRef.get();
  let orderNumber=1;
  if(snap.exists) orderNumber=snap.data().lastOrder+1;
  await counterRef.set({lastOrder:orderNumber});

  cart.forEach(item=> total+=item.total);

  await db.collection("sales").add({
    cashier,role,orderNumber,total,payment,items:cart,
    timestamp:firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… "+orderNumber);
  clearCart();
}

async function dailyReport(){
  const today=new Date(); today.setHours(0,0,0,0);
  const snap=await db.collection("sales")
    .where("timestamp",">=",today).get();
  let total=0;
  snap.forEach(doc=> total+=doc.data().total);
  alert("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…: "+total);
}

async function closeShift(){
  const snap=await db.collection("sales")
    .where("cashier","==",cashier)
    .where("timestamp",">=",shiftStart).get();
  let total=0;
  snap.forEach(doc=> total+=doc.data().total);
  alert("Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´ÙŠÙØª\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+total);
}
</script>

</body>
</html>
