<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“’ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨Ø±Ø¹Ø§Øª</title>
<style>
body { font-family:"Cairo",sans-serif; background:#f4f4f4; margin:0; padding:20px; }
h2 { text-align:center; color:#C1272D; margin-bottom:20px; }
form { display:grid; gap:15px; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); margin-bottom:20px; }
form label { font-weight:bold; }
form input, form select, form textarea { width:95%; padding:8px; border:1px solid #ccc; border-radius:5px; }
form button { padding:10px;background:#C1272D;color:#fff; border:none; border-radius:5px; cursor:pointer; }
form button:hover { background:#a81f25; }
#search { margin-bottom:20px; padding:10px; width:94%; border-radius:5px; border:1px solid #ccc; }
.cards { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:15px; }
.card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); position:relative; }
.card h3 { margin:0 0 10px 0; color:#C1272D; }
.card button { margin-top:5px; }
.card button.delete { background:#e74c3c; color:#fff; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
.card button.edit { background:#3498db; color:#fff; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
#logout { padding:10px 20px; background:#444; color:#fff; border:none; border-radius:5px; cursor:pointer; margin-bottom:20px; }
#logout:hover { background:#222; }
#itemField div { margin-bottom:5px; }
.password-container { position:relative; }
.password-container button { position:absolute; left:5px; top:50%; transform:translateY(-50%); padding:5px; cursor:pointer; background:none; border:none; font-size:1.2em; }
#exportBtn { padding:10px; background:#27ae60; color:#fff; border:none; border-radius:5px; cursor:pointer; margin-bottom:20px; }
#exportBtn:hover { background:#1e8449; }
</style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginSection">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <form id="loginForm">
    <label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input type="email" id="email" required>

    <label>ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <div class="password-container">
      <input type="password" id="password" required>
      <button type="button" id="togglePassword">ğŸ‘ï¸</button>
    </div>

    <button type="submit" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <button type="button" id="resetPassword">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</button>
  </form>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<div id="appSection" style="display:none;">
  <button id="logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  <h2>ğŸ“’ Ø³Ø¬Ù„ Ø§Ù„ØªØ¨Ø±Ø¹Ø§Øª</h2>
  <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§...">
  <button id="exportBtn">ğŸ’¾ ØªØµØ¯ÙŠØ± Excel</button>

  <form id="donationForm">
    <label>Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø©</label>
    <input type="text" id="invoiceNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©" required>

    <label>Ù†ÙˆØ¹ Ø§Ù„ØªØ¨Ø±Ø¹</label>
    <select id="type" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
      <option value="Ù…ØµØ§Ø±ÙŠ">Ù…ØµØ§Ø±ÙŠ</option>
      <option value="Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©">Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©</option>
      <option value="Ù…Ù„Ø§Ø¨Ø³">Ù…Ù„Ø§Ø¨Ø³</option>
      <option value="Ø£Ø­Ø°ÙŠØ©">Ø£Ø­Ø°ÙŠØ©</option>
      <option value="Ø£Ø¯ÙˆÙŠØ©">Ø£Ø¯ÙˆÙŠØ©</option>
      <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
    </select>

    <div id="moneyField" style="display:none;">
      <label>ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº</label>
      <input type="number" id="amount" min="0.01" step="0.01">
      <label>ğŸ’± Ø§Ù„Ø¹Ù…Ù„Ø©</label>
      <select id="currency">
        <option value="Ø¯ÙˆÙ„Ø§Ø±">Ø¯ÙˆÙ„Ø§Ø±</option>
        <option value="Ù„.Ù„">Ù„.Ù„</option>
      </select>
    </div>

    <div id="itemField" style="display:none;">
      <label>ğŸ“¦ Ø§Ù„Ø¹Ù†Ø§ØµØ±</label>
      <div id="itemsContainer"></div>
      <div style="display:flex; gap:5px; margin-top:5px; flex-wrap:wrap;">
        <input type="text" id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±">
        <input type="number" id="itemQuantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" min="0.01" step="0.01">
        <input type="number" id="itemWeight" placeholder="Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØµØ§ÙÙŠ (ÙƒØº)" min="0.01" step="0.01">
        <select id="itemUnit">
          <option value="ÙƒÙŠÙ„Ùˆ">ÙƒÙŠÙ„Ùˆ</option>
          <option value="ØºØ±Ø§Ù…">ØºØ±Ø§Ù…</option>
          <option value="Ù„ØªØ±">Ù„ØªØ±</option>
          <option value="Ù‚Ø·Ø¹Ø©">Ù‚Ø·Ø¹Ø©</option>
        </select>
        <button type="button" id="addItem">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ±</button>
      </div>
    </div>

    <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹</label>
    <input type="text" id="name" required>
    <label>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <input type="text" id="address" required>
    <label>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ</label>
    <input type="text" id="phone" required>
    <label>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
    <textarea id="notes"></textarea>
    <button type="submit">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¨Ø±Ø¹</button>
  </form>

  <div class="cards" id="donationCards"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, deleteDoc, query, orderBy, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = { apiKey:"AIzaSyBGiHaLE8lWuvJgVjDJjw0PXTjdBfTrzno", authDomain:"prizezone-app.firebaseapp.com", projectId:"prizezone-app", storageBucket:"prizezone-app.appspot.com", messagingSenderId:"244427738881", appId:"1:244427738881:web:4a666ce66f74f4994e5500" };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginSection = document.getElementById('loginSection');
const appSection = document.getElementById('appSection');
const typeSelect = document.getElementById('type');
const moneyField = document.getElementById('moneyField');
const itemField = document.getElementById('itemField');
const itemsContainer = document.getElementById('itemsContainer');
const itemsList = [];

// Show/Hide Password
const passwordInput = document.getElementById('password');
const toggleBtn = document.getElementById('togglePassword');
toggleBtn.addEventListener('click', ()=>{
  if(passwordInput.type==='password'){ passwordInput.type='text'; toggleBtn.textContent='ğŸ‘€ï¸'; }
  else{ passwordInput.type='password'; toggleBtn.textContent='ğŸ‘ï¸'; }
});

// Auth
onAuthStateChanged(auth, user=>{
  if(user){ loginSection.style.display='none'; appSection.style.display='block'; renderCards(); }
  else{ loginSection.style.display='block'; appSection.style.display='none'; }
});

document.getElementById('loginForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const email=document.getElementById('email').value;
  const password=document.getElementById('password').value;
  try{ await signInWithEmailAndPassword(auth,email,password); e.target.reset(); }
  catch(err){ alert(err.message); }
});

document.getElementById('resetPassword').addEventListener('click', async ()=>{
  const email=document.getElementById('email').value;
  if(email){ try{ await sendPasswordResetEmail(auth,email); alert('ğŸ“© ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†'); } catch(err){ alert(err.message); } }
  else alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹');
});

document.getElementById('logout').addEventListener('click', ()=>signOut(auth));

// Type Change
typeSelect.addEventListener('change', ()=>{
  if(typeSelect.value==='Ù…ØµØ§Ø±ÙŠ'){ moneyField.style.display='block'; itemField.style.display='none'; itemsList.length=0; itemsContainer.innerHTML=''; }
  else if(typeSelect.value!==''){ moneyField.style.display='none'; itemField.style.display='block'; itemsList.length=0; itemsContainer.innerHTML=''; }
  else{ moneyField.style.display='none'; itemField.style.display='none'; itemsList.length=0; itemsContainer.innerHTML=''; }
});

// Add Item
document.getElementById('addItem').addEventListener('click', ()=>{
  const name = document.getElementById('itemName').value.trim();
  const quantity = Number(document.getElementById('itemQuantity').value);
  const weight = Number(document.getElementById('itemWeight').value);
  const unit = document.getElementById('itemUnit').value;

  if(!name || isNaN(quantity) || isNaN(weight) || !unit){
    alert('âš ï¸ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
    return;
  }

  const item = {name, quantity, weight, unit};
  itemsList.push(item);

  const div = document.createElement('div');
  div.textContent = `${name} - ${quantity} ${unit} - ÙˆØ²Ù† ØµØ§ÙÙŠ: ${weight} ÙƒØº`;
  itemsContainer.appendChild(div);

  document.getElementById('itemName').value='';
  document.getElementById('itemQuantity').value='';
  document.getElementById('itemWeight').value='';
});

// Save Donation
document.getElementById('donationForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const donation={
    invoice: document.getElementById('invoiceNumber').value,
    type: typeSelect.value,
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    phone: document.getElementById('phone').value,
    notes: document.getElementById('notes').value,
    date: new Date().toISOString()
  };
  if(typeSelect.value==='Ù…ØµØ§Ø±ÙŠ'){ donation.amount=document.getElementById('amount').value; donation.currency=document.getElementById('currency').value; }
  else{ donation.items=[...itemsList]; }
  try{ await addDoc(collection(db,"donations"),donation); e.target.reset(); moneyField.style.display='none'; itemField.style.display='none'; itemsList.length=0; itemsContainer.innerHTML=''; }
  catch(err){ alert(err.message); }
});

// Render Cards
function renderCards(filter=''){
  const container=document.getElementById('donationCards');
  const q=query(collection(db,"donations"), orderBy("date","desc"));
  onSnapshot(q,snapshot=>{
    container.innerHTML='';
    snapshot.forEach(docSnap=>{
      const donation=docSnap.data(); donation.id=docSnap.id;
      if(filter && !Object.values(donation).some(v=>v && JSON.stringify(v).toLowerCase().includes(filter.toLowerCase()))) return;
      const card=document.createElement('div'); card.className='card';
      let content=`<h3>Ø§Ù„ØªØ¨Ø±Ø¹: ${donation.type}</h3><p>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${donation.invoice}</p>`;
      if(donation.type==='Ù…ØµØ§Ø±ÙŠ'){ content+=`<p>ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${donation.amount} ${donation.currency}</p>`; }
      else{ content+=`<p>ğŸ“¦ Ø§Ù„Ø¹Ù†Ø§ØµØ±:</p>`; donation.items.forEach(item=>{ content+=`<p>â€¢ ${item.name} - ${item.quantity} ${item.unit} - ÙˆØ²Ù† ØµØ§ÙÙŠ: ${item.weight} ÙƒØº</p>`; }); }
      content+=`<p>ğŸ‘¤ Ø§Ù„Ù…ØªØ¨Ø±Ø¹: ${donation.name}</p><p>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${donation.address}</p><p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${donation.phone}</p><p>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${donation.notes}</p><p>â° Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(donation.date).toLocaleString()}</p>`;
      content+=`<button class="edit" onclick="editDonation('${donation.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button> <button class="delete" onclick="deleteDonation('${donation.id}')">ğŸ—‘ Ø­Ø°Ù</button>`;
      card.innerHTML=content;
      container.appendChild(card);
    });
  });
}

// Delete
window.deleteDonation=async function(id){ if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¨Ø±Ø¹ØŸ')){ try{ await deleteDoc(doc(db,"donations",id)); } catch(err){ alert(err.message); } } }

// Edit
window.editDonation=function(id){ alert('Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø³ØªÙØ¶Ø§Ù Ù„Ø§Ø­Ù‚Ø§Ù‹'); }

// Search
document.getElementById('search').addEventListener('input', function(){ renderCards(this.value); });

// Export Excel
document.getElementById('exportBtn').addEventListener('click', ()=>{
  let data='Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©\tÙ†ÙˆØ¹ Ø§Ù„ØªØ¨Ø±Ø¹\tØ§Ù„Ø¹Ù†Ø§ØµØ±/Ø§Ù„Ù…Ø¨Ù„Øº\tØ§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹\tØ§Ù„Ø¹Ù†ÙˆØ§Ù†\tØ§Ù„Ù‡Ø§ØªÙ\tÙ…Ù„Ø§Ø­Ø¸Ø§Øª\tØ§Ù„ØªØ§Ø±ÙŠØ®\n';
  const container=document.getElementById('donationCards');
  container.querySelectorAll('.card').forEach(card=>{
    const lines=card.innerText.split('\n').map(l=>l.replace('âœï¸ ØªØ¹Ø¯ÙŠÙ„','').replace('ğŸ—‘ Ø­Ø°Ù','').trim());
    data+=lines.join('\t')+'\n';
  });
  const blob=new Blob([data],{type:'text/tab-separated-values'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download='donations.xls'; a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
