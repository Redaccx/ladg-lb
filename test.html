<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: "Segoe UI", Tahoma, sans-serif; background: #f4f6f9; margin:0; padding:0; text-align:center; overflow-x:hidden;}
  header { background:#2c3e50; color:white; padding:15px; font-size:20px;}
  main { padding:20px; max-width:1000px; margin:auto;}
  input { padding:10px; width:220px; border:1px solid #ccc; border-radius:5px; margin-bottom:10px;}
  button { padding:10px 18px; margin:5px; cursor:pointer; border:none; border-radius:5px; font-size:14px; transition:0.3s;}
  button:hover{opacity:0.85;}
  .in{background:#27ae60;color:white;}
  .out{background:#e74c3c;color:white;}
  .edit{background:#f1c40f;color:black;}
  .delete{background:#7f8c8d;color:white;}
  .excel{background:#2980b9;color:white;}
  .login{background:#34495e;color:white;}
  .logout{background:#8e44ad;color:white;}
  .settings{background:#16a085;color:white;}
  table{width:100%; border-collapse:collapse; margin-top:20px; background:white; box-shadow:0px 2px 6px rgba(0,0,0,0.1);}
  th, td{border:1px solid #ddd; padding:12px; text-align:center; font-size:14px;}
  th{background:#34495e;color:white;}
  .status-hadir{color:#27ae60;font-weight:bold;}
  .status-ghayeb{color:#e74c3c;font-weight:bold;}
  #loginPage, #app, #settingsPage, #splash{display:none;}
  p.rights{margin-top:20px; font-size:12px; color:#555;}
  p.rights a{color:#2980b9;text-decoration:none;}
  .login-container{background:white; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.2); display:inline-block; margin-top:30px;}
  .desc{font-size:14px; color:#555; margin-bottom:10px;}
  .table-container{overflow-x:auto;}
  @media (max-width:768px){input{width:100%;} button{width:100%;margin:5px 0;} table, th, td{font-size:12px;}}
</style>
</head>
<body>

<!-- Splash Screen -->
<div id="splash" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#2c3e50; color:white; display:flex; align-items:center; justify-content:center; flex-direction:column; font-size:20px;">
  <div>Loading Attendance System...</div>
  <div style="margin-top:10px;">‚è≥</div>
</div>

<header>üìã Attendance System</header>

<!-- Login Page -->
<div id="loginPage">
  <div class="login-container">
    <h2>üîë Login</h2>
    <div class="desc">Attendance System for Employees</div>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button class="login" onclick="login()">Login</button>

  </div>
</div>

<!-- Settingsclass="" Page -->
<div id="settingsPage">
  <div class="login-container">
    <h2>‚öôÔ∏è Settings</h2>
    <div class="desc">Change login password</div>
    <input type="password" id="oldPass" placeholder="Old Password"><br>
    <input type="password" id="newPass" placeholder="New Password"><br>
    <button class="settings" onclick="changePassword()">Change Password</button>
    <button class="logout" onclick="closeSettings()">Back</button>
  </div>
</div>

<!-- App Page -->
<div id="app">
<main>
<button class="logout" onclick="logout()">üö™ Logout</button>
<div class="controls">
<input type="text" id="name" placeholder="Enter Employee Name"><br>
<button class="in" onclick="checkIn()">Check In</button>
<button class="out" onclick="checkOut()">Check Out</button>
<button class="excel" onclick="exportExcel()">üìä Export Excel</button>
</div>

<h2>üìë Records</h2>
<div class="table-container">
<table id="attendanceTable">
<tr>
<th>Name</th><th>Date</th><th>Check In</th><th>Check Out</th><th>Duration</th><th>Status</th><th>Actions</th>
</tr>
</table>
</div>

<p class="rights">¬© 2025 This system is developed by <a href="https://www.instagram.com/beweble" target="_blank">beweble</a></p>
</main>
</div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script>
// Splash Screen
document.getElementById("splash").style.display="flex";
setTimeout(()=>{document.getElementById("splash").style.display="none"; document.getElementById("loginPage").style.display="block";},1500);

// Login Data
let savedUser = { username:"ladg", password:"ladg@$2025" };

// Login Function
function login(){
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  if(username===savedUser.username && password===savedUser.password){
    document.getElementById("loginPage").style.display="none";
    document.getElementById("app").style.display="block";
    loadData();
  } else alert("‚ö†Ô∏è Incorrect username or password");
}

// Logout Function
function logout(){
  document.getElementById("app").style.display="none";
  document.getElementById("loginPage").style.display="block";
  document.getElementById("username").value="";
  document.getElementById("password").value="";
}

// Open & Close Settings
function openSettings(){ document.getElementById("loginPage").style.display="none"; document.getElementById("settingsPage").style.display="block";}
function closeSettings(){ document.getElementById("settingsPage").style.display="none"; document.getElementById("loginPage").style.display="block";}

// Change Password
function changePassword(){
  const oldPass = document.getElementById("oldPass").value.trim();
  const newPass = document.getElementById("newPass").value.trim();
  if(oldPass !== savedUser.password) return alert("‚ö†Ô∏è Old password incorrect");
  if(!newPass) return alert("‚ö†Ô∏è Enter new password");
  savedUser.password = newPass;
  alert("‚úÖ Password changed successfully");
  document.getElementById("oldPass").value="";
  document.getElementById("newPass").value="";
}

// Format Date DD/MM/YYYY
function formatDate(dateStr){ const d = new Date(dateStr); return `${String(d.getDate()).padStart(2,"0")}/${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`;}

// Format Duration Hours & Minutes
function formatDuration(checkin, checkout){ const diff = new Date(checkout) - new Date(checkin); const totalMinutes = Math.floor(diff / 1000 / 60); return `${Math.floor(totalMinutes/60)}h ${totalMinutes%60}m`;}

// Load Records
function loadData(){
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const table = document.getElementById("attendanceTable");
  table.innerHTML=`<tr><th>Name</th><th>Date</th><th>Check In</th><th>Check Out</th><th>Duration</th><th>Status</th><th>Actions</th></tr>`;
  records.forEach((r,i)=>{
    const row = table.insertRow();
    row.insertCell(0).innerText = r.name;
    row.insertCell(1).innerText = formatDate(r.date);
    row.insertCell(2).innerText = new Date(r.checkin).toLocaleTimeString("en-GB");
    row.insertCell(3).innerText = r.checkout ? new Date(r.checkout).toLocaleTimeString("en-GB") : "-";
    row.insertCell(4).innerText = r.checkout ? formatDuration(r.checkin, r.checkout) : "-";
    const statusCell = row.insertCell(5);
    statusCell.innerText = r.status || "-";
    statusCell.className = r.status === "ÿ≠ÿßÿ∂ÿ±" ? "status-hadir" : "status-ghayeb";
    const actions = row.insertCell(6);
    actions.innerHTML = `<button class="edit" onclick="editRecord(${i})">Edit</button>
                         <button class="delete" onclick="deleteRecord(${i})">Delete</button>
                         <button class="in" onclick="toggleStatus(${i})">Toggle Status</button>`;
  });
}

// Check In
function checkIn(){
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("‚ö†Ô∏è Please enter employee name");
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const now = new Date();
  records.push({name, date: now.toISOString(), checkin: now.toISOString(), checkout:null, status:"ÿ≠ÿßÿ∂ÿ±"});
  localStorage.setItem("attendance", JSON.stringify(records));
  loadData();
}

// Check Out
function checkOut(){
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("‚ö†Ô∏è Please enter employee name");
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const record = [...records].reverse().find(r=>r.name===name && !r.checkout);
  if(record){ record.checkout = new Date().toISOString(); localStorage.setItem("attendance", JSON.stringify(records)); loadData(); }
  else alert("‚ö†Ô∏è Employee has not checked in yet");
}

// Toggle Status
function toggleStatus(index){ const records = JSON.parse(localStorage.getItem("attendance")||"[]"); const r = records[index]; r.status = r.status === "ÿ≠ÿßÿ∂ÿ±" ? "ÿ∫ÿßÿ¶ÿ®" : "ÿ≠ÿßÿ∂ÿ±"; localStorage.setItem("attendance", JSON.stringify(records)); loadData();}

// Edit Record
function editRecord(index){
  const records = JSON.parse(localStorage.getItem("attendance")||"[]"); const r = records[index];
  const newCheckIn = prompt("üïí Enter new Check-In time (HH:MM:SS):", new Date(r.checkin).toLocaleTimeString("en-GB"));
  if(newCheckIn){ const d=new Date(r.date); const [h,m,s]=newCheckIn.split(":").map(Number); d.setHours(h); d.setMinutes(m); d.setSeconds(s||0); r.checkin=d.toISOString();}
  let newCheckOut = r.checkout ? new Date(r.checkout).toLocaleTimeString("en-GB") : "";
  newCheckOut = prompt("üïí Enter new Check-Out time (HH:MM:SS, leave empty if not yet):", newCheckOut);
  if(newCheckOut){ const d=new Date(r.date); const [h,m,s]=newCheckOut.split(":").map(Number); d.setHours(h); d.setMinutes(m); d.setSeconds(s||0); r.checkout=d.toISOString();}
  localStorage.setItem("attendance", JSON.stringify(records)); loadData();
}

// Delete Record
function deleteRecord(index){ if(!confirm("‚ö†Ô∏è Are you sure you want to delete this record?")) return; const records = JSON.parse(localStorage.getItem("attendance")||"[]"); records.splice(index,1); localStorage.setItem("attendance", JSON.stringify(records)); loadData();}

// Export Excel
function exportExcel(){
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const data = records.map(r=>({Name:r.name, Date:formatDate(r.date), "Check In":new Date(r.checkin).toLocaleTimeString("en-GB"), "Check Out":r.checkout?new Date(r.checkout).toLocaleTimeString("en-GB"):"-", Duration:r.checkout?formatDuration(r.checkin,r.checkout):"-", Status:r.status||"-"}));
  const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Records"); XLSX.writeFile(wb,"attendance.xlsx");
}
</script>
</body>
</html>
