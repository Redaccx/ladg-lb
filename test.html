<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Tahoma; background: #f0f0f0; padding: 20px; margin: 0; }
    .news-form, .post { background: white; padding: 15px; margin: 20px auto; max-width: 600px; border-radius: 6px; box-shadow: 0 0 5px #ccc; }
    input, textarea { width: 100%; margin: 8px 0; padding: 8px; font-size: 14px; }
    button { background: #C1272D; color: white; padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; margin-top: 5px; }
    .post img { width: 300px; height: 300px; object-fit: cover; border-radius: 6px; margin-bottom: 10px; display: block; }
    .like-btn { background: #0077cc; margin-left: 5px; }
    .delete-btn { background: #999; }
    .loading { color: green; display: none; }
  </style>
</head>
<body>

<div class="news-form">
  <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
  <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±">
  <textarea id="content" placeholder="Ù†Øµ Ø§Ù„Ø®Ø¨Ø±"></textarea>
  <input type="text" id="link" placeholder="Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <input type="file" id="image" accept="image/*">
  <button onclick="addPost()">Ù†Ø´Ø±</button>
  <p id="loading" class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...</p>
</div>

<div id="posts"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
  const firebaseConfig = {
    apiKey: "AIzaSyBxbcWmHfbEFfZp1aYToB9mmqKQIVY5lFQ",
    authDomain: "my-newss-app.firebaseapp.com",
    projectId: "my-newss-app",
    storageBucket: "my-newss-app.appspot.com",
    messagingSenderId: "848384049969",
    appId: "1:848384049969:web:1a2aca7a0c3315e4966610"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // âœ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´ÙˆØ±
  async function addPost() {
    const title = document.getElementById("title").value.trim();
    const content = document.getElementById("content").value.trim();
    const link = document.getElementById("link").value.trim();
    const imageInput = document.getElementById("image");
    const loading = document.getElementById("loading");

    if (!title || !content || !imageInput.files[0]) {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");
      return;
    }

    loading.style.display = "block";

    const reader = new FileReader();
    reader.onload = async function(e) {
      const imageBase64 = e.target.result;

      await db.collection("news").add({
        title,
        content,
        link,
        image: imageBase64,
        date: new Date().toISOString(),
        likes: 0
      });

      loading.style.display = "none";
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      document.getElementById("link").value = "";
      document.getElementById("image").value = "";
      loadPosts();
    };

    reader.readAsDataURL(imageInput.files[0]);
  }

  // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
  async function loadPosts() {
    const container = document.getElementById("posts");
    container.innerHTML = "";
    const snapshot = await db.collection("news").orderBy("date", "desc").get();

    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <img src="${data.image}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø®Ø¨Ø±">
        <h4>${data.title}</h4>
        <p>${data.content}</p>
        ${data.link ? `<a href="${data.link}" target="_blank">${data.link}</a>` : ""}
        <p style="font-size: 12px; color: gray;">${new Date(data.date).toLocaleString()}</p>
        <button class="like-btn" onclick="likePost('${doc.id}', ${data.likes})">â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨ (${data.likes})</button>
        <button class="delete-btn" onclick="deletePost('${doc.id}')">ğŸ—‘ Ø­Ø°Ù</button>
      `;
      container.appendChild(div);
    });
  }

  // âœ… Ø­Ø°Ù Ù…Ù†Ø´ÙˆØ±
  async function deletePost(id) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ±ØŸ")) {
      await db.collection("news").doc(id).delete();
      loadPosts();
    }
  }

  // âœ… Ù„Ø§ÙŠÙƒ
  async function likePost(id, currentLikes) {
    await db.collection("news").doc(id).update({ likes: currentLikes + 1 });
    loadPosts();
  }

  window.onload = loadPosts;
</script>

</body>
</html>
