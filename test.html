<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; font-family: Arial, sans-serif; direction:rtl; }
body { background: #f5f6fa; }
header { background:#2c3e50; color:white; padding:15px; font-size:22px; text-align:center; position:relative; }
#menuBtn { position:absolute; right:15px; top:15px; font-size:26px; cursor:pointer; }
#sidebar { position:fixed; right:-260px; top:0; width:260px; height:100%; background:#34495e; padding:20px; transition:0.3s; z-index:1000; border-left:2px solid #2c3e50; }
#sidebar button { width:100%; padding:12px; margin:10px 0; border:none; border-radius:5px; cursor:pointer; color:white; font-size:15px; }
#sidebar button:hover { opacity:0.85; }
#sidebar #closeSidebar { background:#e74c3c; }
#sidebar #changePass { background:#16a085; }
#sidebar #contact { background:#2980b9; }

/* Login */
.login-container { width:320px; margin:80px auto; background:white; padding:25px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); text-align:center; }
.login-container h2 { margin-bottom:20px; }
.login-container input { width:100%; padding:12px; margin:8px 0; border-radius:5px; border:1px solid #ccc; }
.login-container button { width:100%; padding:12px; border:none; border-radius:5px; background:#27ae60; color:white; font-size:16px; cursor:pointer; margin-top:10px; transition:0.3s; }
.login-container button:hover { opacity:0.85; }

/* Change Password */
#changePassDiv { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; z-index:2000; }
.change-pass-container { background:white; padding:25px; border-radius:10px; width:320px; text-align:center; box-shadow:0 5px 15px rgba(0,0,0,0.3); }
.change-pass-container input { width:100%; padding:12px; margin:8px 0; border-radius:5px; border:1px solid #ccc; }
.change-pass-container button { width:100%; padding:12px; margin:8px 0; border:none; border-radius:5px; font-size:15px; cursor:pointer; }
.change-pass-container button.save { background:#16a085; color:white; }
.change-pass-container button.cancel { background:#e74c3c; color:white; }

/* App */
#app { display:none; padding:20px; }
#app button.logout { background:#8e44ad; color:white; border:none; padding:10px 18px; border-radius:5px; cursor:pointer; margin-bottom:15px; }
#app .controls { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; }
#app .controls input { padding:10px; flex:1; min-width:120px; border-radius:5px; border:1px solid #ccc; }
#app .controls button { padding:10px 18px; border:none; border-radius:5px; cursor:pointer; flex:1; min-width:120px; color:white; font-size:14px; }
#app .controls button.checkin { background:#27ae60; }
#app .controls button.checkout { background:#e74c3c; }
#app .controls button.present { background:#2980b9; }
#app .controls button.absent { background:#7f8c8d; }
#app .controls button.export { background:#f39c12; }

/* Table */
.table-container { overflow-x:auto; }
table { width:100%; border-collapse:collapse; background:white; }
th, td { border:1px solid #ddd; padding:10px; text-align:center; font-size:14px; }
th { background:#34495e; color:white; }
td button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; margin:2px; font-size:13px; }
td button.edit { background:#f1c40f; color:black; }
td button.delete { background:#e74c3c; color:white; }

@media(max-width:768px){
  .login-container,.change-pass-container{width:90%;}
  #app .controls{flex-direction:column;}
  table,th,td{font-size:12px;}
}
</style>
</head>
<body>

<header>
  <span id="menuBtn" onclick="openSidebar()">â˜°</span>
  ğŸ“‹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±
</header>

<!-- Sidebar -->
<div id="sidebar">
  <button id="closeSidebar" onclick="closeSidebar()">Ø¥ØºÙ„Ø§Ù‚ Ã—</button>
  <button id="changePass" onclick="openChangePass()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
  <button id="contact" onclick="window.open('https://www.instagram.com/beweble','_blank')">ØªÙˆØ§ØµÙ„ @beweble</button>
</div>

<!-- Login -->
<div id="loginPage">
  <div class="login-container">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<!-- Change Password Modal -->
<div id="changePassDiv">
  <div class="change-pass-container">
    <h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
    <input type="password" id="oldPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©">
    <input type="password" id="newPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
    <button class="save" onclick="changePassword()">Ø­ÙØ¸</button>
    <button class="cancel" onclick="closeChangePass()">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>

<!-- App -->
<div id="app">
  <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  <div class="controls">
    <input type="text" id="empName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
    <button class="checkin" onclick="checkIn()">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>
    <button class="checkout" onclick="checkOut()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    <button class="present" onclick="markPresent()">Ø­Ø§Ø¶Ø±</button>
    <button class="absent" onclick="markAbsent()">ØºØ§Ø¦Ø¨</button>
    <button class="export" onclick="exportExcel()">ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
  </div>
  <div class="table-container">
    <table id="attendanceTable">
      <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th><th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
    </table>
  </div>
</div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script>
/* ---------- Login ---------- */
let savedUser = {username:"ladg", password:localStorage.getItem("attendancePass")||"ladg@$2025"};
if(localStorage.getItem("loggedIn")==="true"){document.getElementById("app").style.display="block"; loadData();}
else{document.getElementById("loginPage").style.display="block";}
function login(){
  const u=document.getElementById("username").value.trim();
  const p=document.getElementById("password").value.trim();
  if(u===savedUser.username && p===savedUser.password){
    localStorage.setItem("loggedIn","true");
    document.getElementById("loginPage").style.display="none";
    document.getElementById("app").style.display="block";
    loadData();
  }else alert("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦");
}
function logout(){ localStorage.setItem("loggedIn","false"); location.reload(); }

/* ---------- Sidebar ---------- */
function openSidebar(){ document.getElementById("sidebar").style.right="0"; }
function closeSidebar(){ document.getElementById("sidebar").style.right="-260px"; }
function openChangePass(){ document.getElementById("changePassDiv").style.display="flex"; }
function closeChangePass(){ document.getElementById("changePassDiv").style.display="none"; }
function changePassword(){
  const oldP=document.getElementById("oldPass").value.trim();
  const newP=document.getElementById("newPass").value.trim();
  if(oldP!==savedUser.password){ alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø®Ø§Ø·Ø¦Ø©"); return; }
  if(!newP){ alert("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©"); return; }
  savedUser.password=newP; localStorage.setItem("attendancePass",newP);
  alert("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­"); closeChangePass();
}

/* ---------- Attendance ---------- */
function loadData(){
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  const table=document.getElementById("attendanceTable");
  table.innerHTML=`<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th><th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>`;
  const now=new Date();
  const weekAgo=new Date(now.getTime()-7*24*60*60*1000);
  records.forEach((r,i)=>{
    if(new Date(r.date)>=weekAgo){
      const row=table.insertRow();
      row.insertCell(0).innerText=r.name;
      row.insertCell(1).innerText=r.date;
      row.insertCell(2).innerText=r.checkin?r.checkin:"-";
      row.insertCell(3).innerText=r.checkout?r.checkout:"-";
      row.insertCell(4).innerText=r.status?r.status:"-";
      row.insertCell(5).innerText=r.checkin&&r.checkout?getDuration(r.checkin,r.checkout):"-";
      const actions=row.insertCell(6);
      actions.innerHTML=`<button class="edit" onclick="editRecord(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
                         <button class="delete" onclick="deleteRecord(${i})">Ø­Ø°Ù</button>`;
    }
  });
}
function getDuration(checkin, checkout){
  const diff=new Date('1970-01-01T'+checkout)-new Date('1970-01-01T'+checkin);
  const minutes=Math.floor(diff/1000/60);
  const h=Math.floor(minutes/60); const m=minutes%60;
  return `${h}Ø³ ${m}Ø¯`;
}
function checkIn(){
  const name=document.getElementById("empName").value.trim();
  if(!name){ alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù"); return; }
  const now=new Date(); const time=now.toLocaleTimeString("en-GB");
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  records.push({name,date:now.toLocaleDateString("en-GB"),checkin:time,checkout:null,status:"Ø­Ø§Ø¶Ø±"});
  localStorage.setItem("attendance",JSON.stringify(records));
  loadData();
}
function checkOut(){
  const name=document.getElementById("empName").value.trim();
  if(!name){ alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù"); return; }
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  for(let i=records.length-1;i>=0;i--){
    if(records[i].name===name && !records[i].checkout){
      const now=new Date(); records[i].checkout=now.toLocaleTimeString("en-GB");
      break;
    }
  }
  localStorage.setItem("attendance",JSON.stringify(records));
  loadData();
}
function markPresent(){
  const name=document.getElementById("empName").value.trim();
  if(!name){ alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù"); return; }
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  records.push({name,date:new Date().toLocaleDateString("en-GB"),checkin:null,checkout:null,status:"Ø­Ø§Ø¶Ø±"});
  localStorage.setItem("attendance",JSON.stringify(records));
  loadData();
}
function markAbsent(){
  const name=document.getElementById("empName").value.trim();
  if(!name){ alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù"); return; }
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  records.push({name,date:new Date().toLocaleDateString("en-GB"),checkin:null,checkout:null,status:"ØºØ§Ø¦Ø¨"});
  localStorage.setItem("attendance",JSON.stringify(records));
  loadData();
}
function editRecord(index){
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  const r=records[index];
  const newName=prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:", r.name); if(newName) r.name=newName;
  const newCheckIn=prompt("ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ (HH:MM:SS):", r.checkin?r.checkin:""); if(newCheckIn) r.checkin=newCheckIn;
  const newCheckOut=prompt("ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬ (HH:MM:SS):", r.checkout?r.checkout:""); if(newCheckOut) r.checkout=newCheckOut;
  const newStatus=prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© (Ø­Ø§Ø¶Ø±/ØºØ§Ø¦Ø¨):", r.status?r.status:""); if(newStatus) r.status=newStatus;
  localStorage.setItem("attendance",JSON.stringify(records));
  loadData();
}
function deleteRecord(index){
  if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ")) return;
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  records.splice(index,1);
  localStorage.setItem("attendance",JSON.stringify(records));
  loadData();
}

/* ---------- Export Excel ---------- */
function exportExcel(){
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  const now=new Date(); const weekAgo=new Date(now.getTime()-7*24*60*60*1000);
  const weekRecords=records.filter(r=>new Date(r.date)>=weekAgo);
  const data=weekRecords.map(r=>({Ø§Ù„ØªØ§Ø±ÙŠØ®:r.date, Ø§Ù„Ø§Ø³Ù…:r.name, "ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„":r.checkin, "ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬":r.checkout, Ø§Ù„Ø­Ø§Ù„Ø©:r.status, Ø§Ù„Ù…Ø¯Ø©:r.checkin&&r.checkout?getDuration(r.checkin,r.checkout):"-"}));
  const ws=XLSX.utils.json_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹");
  XLSX.writeFile(wb, "Attendance_Week.xlsx");
}
</script>
</body>
</html>
