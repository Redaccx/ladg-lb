<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة إدارة الأخبار</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Tahoma; background: #f0f0f0; padding: 20px; margin: 0; }
    .news-form, .post { background: white; padding: 15px; margin: 20px auto; max-width: 600px; border-radius: 6px; box-shadow: 0 0 5px #ccc; }
    input, textarea { width: 100%; margin: 8px 0; padding: 8px; font-size: 14px; }
    button { background: #C1272D; color: white; padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; margin-top: 5px; }
    .post img { width: 300px; height: 300px; object-fit: cover; border-radius: 6px; margin-bottom: 10px; display: block; }
    .like-btn { background: #0077cc; margin-left: 5px; }
    .delete-btn { background: #999; }
    .loading { color: green; display: none; }
  </style>
</head>
<body>

<div class="news-form">
  <h3>إضافة منشور جديد</h3>
  <input type="text" id="title" placeholder="عنوان الخبر">
  <textarea id="content" placeholder="نص الخبر"></textarea>
  <input type="text" id="link" placeholder="رابط خارجي (اختياري)">
  <input type="file" id="image" accept="image/*">
  <button onclick="addPost()">نشر</button>
  <p id="loading" class="loading">⏳ جاري الإضافة...</p>
</div>

<div id="posts"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ✅ إعدادات Firebase الخاصة بك
  const firebaseConfig = {
    apiKey: "AIzaSyBxbcWmHfbEFfZp1aYToB9mmqKQIVY5lFQ",
    authDomain: "my-newss-app.firebaseapp.com",
    projectId: "my-newss-app",
    storageBucket: "my-newss-app.appspot.com",
    messagingSenderId: "848384049969",
    appId: "1:848384049969:web:1a2aca7a0c3315e4966610"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ✅ إضافة منشور
  async function addPost() {
    const title = document.getElementById("title").value.trim();
    const content = document.getElementById("content").value.trim();
    const link = document.getElementById("link").value.trim();
    const imageInput = document.getElementById("image");
    const loading = document.getElementById("loading");

    if (!title || !content || !imageInput.files[0]) {
      alert("يرجى تعبئة جميع الحقول المطلوبة.");
      return;
    }

    loading.style.display = "block";

    const reader = new FileReader();
    reader.onload = async function(e) {
      const imageBase64 = e.target.result;

      await db.collection("news").add({
        title,
        content,
        link,
        image: imageBase64,
        date: new Date().toISOString(),
        likes: 0
      });

      loading.style.display = "none";
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      document.getElementById("link").value = "";
      document.getElementById("image").value = "";
      loadPosts();
    };

    reader.readAsDataURL(imageInput.files[0]);
  }

  // ✅ تحميل المنشورات
  async function loadPosts() {
    const container = document.getElementById("posts");
    container.innerHTML = "";
    const snapshot = await db.collection("news").orderBy("date", "desc").get();

    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <img src="${data.image}" alt="صورة الخبر">
        <h4>${data.title}</h4>
        <p>${data.content}</p>
        ${data.link ? `<a href="${data.link}" target="_blank">${data.link}</a>` : ""}
        <p style="font-size: 12px; color: gray;">${new Date(data.date).toLocaleString()}</p>
        <button class="like-btn" onclick="likePost('${doc.id}', ${data.likes})">❤️ إعجاب (${data.likes})</button>
        <button class="delete-btn" onclick="deletePost('${doc.id}')">🗑 حذف</button>
      `;
      container.appendChild(div);
    });
  }

  // ✅ حذف منشور
  async function deletePost(id) {
    if (confirm("هل أنت متأكد من حذف هذا المنشور؟")) {
      await db.collection("news").doc(id).delete();
      loadPosts();
    }
  }

  // ✅ لايك
  async function likePost(id, currentLikes) {
    await db.collection("news").doc(id).update({ likes: currentLikes + 1 });
    loadPosts();
  }

  window.onload = loadPosts;
</script>

</body>
</html>
