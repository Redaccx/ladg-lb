<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI CV Analyzer v13</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body {margin:0; padding:0; font-family:'Segoe UI',sans-serif; background:#0d0d0d; overflow-x:hidden;}
#bgCanvas {position:fixed; top:0; left:0; width:100%; height:100%; z-index:-2; background:#0d0d0d;}

/* Promo Pop-up */
#promoScreen {position:fixed; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.85); z-index:9999; flex-direction:column;}
#promoScreen video {width:80%; max-width:800px; border-radius:15px;}
#promoScreen h1 {color:#0ff; text-align:center; margin-top:20px; text-shadow:0 0 10px #0ff;}
#skipBtn {position:absolute; top:20px; right:20px; padding:10px 15px; background:#0ff; color:#000; border:none; border-radius:5px; cursor:pointer; font-weight:bold; box-shadow:0 0 10px #0ff,0 0 20px #0ff inset; animation: pulse 1.5s infinite alternate;}
@keyframes pulse {0%{box-shadow:0 0 10px #0ff,0 0 20px #0ff inset;}50%{box-shadow:0 0 15px #0ff,0 0 25px #0ff inset;}100%{box-shadow:0 0 10px #0ff,0 0 20px #0ff inset;}}

/* Container */
.container {position:relative; max-width:1000px; margin:40px auto; background: rgba(17,17,17,0.95); padding:20px; border-radius:12px; display:none; box-shadow:0 0 20px rgba(0,255,255,0.3);}
h1 {color:#00f5ff; text-align:center; margin-bottom:20px; text-shadow:0 0 10px #00f5ff;}
input[type=file] {margin-bottom:15px; width:100%; padding:8px; border-radius:5px; border:1px solid #00f5ff; background:#222; color:#fff;}
button {padding:10px 15px; background:#00f5ff; color:#000; border:none; cursor:pointer; border-radius:5px; margin-bottom:10px; font-weight:bold;}
button:disabled {background:#333; cursor:not-allowed;}

/* Cards */
.cards {display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-top:20px;}
.card {background:#111; padding:15px; border-radius:12px; flex:1 1 320px; box-shadow:0 0 15px rgba(0,255,255,0.3); opacity:0; transform:translateY(50px); transition: all 0.8s ease, box-shadow 0.5s ease-in-out;}
.card.show {opacity:1; transform:translateY(0);}
.card img {width:100%; height:180px; object-fit:cover; border-radius:10px;}
.card h3 {margin:10px 0 5px 0; color:#00f5ff;}
.card .info {margin:5px 0; color:#0ff; font-size:0.95em;}
.status {font-weight:bold; margin-top:5px; padding:5px 10px; border-radius:5px; display:inline-block;}
.status.accept {color:#0f0; background:rgba(0,255,0,0.2);}
.status.reject {color:#f00; background:rgba(255,0,0,0.2); animation: flash 1s infinite alternate;}
@keyframes flash {0%{box-shadow:0 0 10px #f00;}50%{box-shadow:0 0 20px #f00;}100%{box-shadow:0 0 10px #f00;}}

.loader {display:none; text-align:center; margin:20px; font-size:1.2em; color:#00f5ff; text-shadow:0 0 10px #0ff; animation: blink 1.2s infinite;}
@keyframes blink {0%,50%,100%{opacity:1;}25%,75%{opacity:0.2;}}
@media(max-width:600px){.cards{flex-direction:column;align-items:center;}}
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>

<!-- Promo Pop-up -->
<div id="promoScreen">
  <video id="promoVideo" autoplay muted playsinline>
    <source src="https://l.top4top.io/m_357976fbq1.mp4" type="video/mp4">
  </video>
  <h1>ðŸš€ Professional ATS AI CV Analyzer â€“ Developed by Rida Jomaa</h1>
</div>

<!-- Main Container -->
<div class="container">
<h1>ðŸ¤– AI CV Analyzer v13</h1>
<p>Upload PDF CVs. The AI scans multiple specialties with realistic evaluation.</p>
<input type="file" id="pdfFiles" accept="application/pdf" multiple>
<button id="analyzeBtn" onclick="analyzeBatch()">Analyze CVs</button>
<button id="downloadExcel" style="display:none;" onclick="downloadExcel()">Download Excel</button>
<div id="loader" class="loader">ðŸ¤– AI is analyzing your CVs... Processing...</div>
<div class="cards" id="resultsCards"></div>
</div>

<!-- Audio -->
<audio id="bgAudio" loop>
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>
<audio id="soundAccept">
  <source src="https://freesound.org/data/previews/273/273183_5121236-lq.mp3" type="audio/mpeg">
</audio>
<audio id="soundReject">
  <source src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3" type="audio/mpeg">
</audio>

<script>
// Background animation
const canvas=document.getElementById('bgCanvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
let lines=[]; for(let i=0;i<50;i++){lines.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, len:50+Math.random()*100, speed:1+Math.random()*2});}
function animateBG(){ctx.fillStyle='rgba(13,13,13,0.3)'; ctx.fillRect(0,0,canvas.width,canvas.height);ctx.strokeStyle='#0ff'; ctx.lineWidth=1; lines.forEach(l=>{ctx.beginPath();ctx.moveTo(l.x,l.y);ctx.lineTo(l.x,l.y+l.len);ctx.stroke();l.y+=l.speed;if(l.y>canvas.height) l.y=-l.len;});requestAnimationFrame(animateBG);}
animateBG();
window.addEventListener('resize',()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});

// Promo pop-up logic
const promoScreen = document.getElementById('promoScreen');
const promoVideo = document.getElementById('promoVideo');
const container = document.querySelector('.container');
const bgAudio = document.getElementById('bgAudio');

function showMainContent() {
    promoScreen.style.display='none';
    container.style.display='block';
    bgAudio.play().catch(()=>{});
}

if(!sessionStorage.getItem('promoShown')){
    sessionStorage.setItem('promoShown','true');
    const skipBtn = document.createElement('button');
    skipBtn.id="skipBtn";
    skipBtn.innerText="Skip Video";
    skipBtn.onclick = showMainContent;
    promoScreen.appendChild(skipBtn);
    promoVideo.onended = showMainContent;
} else { showMainContent(); }

// PDF + CV Analyzer
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
const specialties=["IT / Software Development","Web & Mobile Development","Data Science & Analytics","AI / Machine Learning","Cybersecurity","Project Management","HR","Finance / Accounting","Marketing / Digital Marketing","Sales / Customer Service","Graphic Design / UI-UX"];
let results=[];
function playSound(type){ if(type==='accept') document.getElementById('soundAccept').play(); if(type==='reject') document.getElementById('soundReject').play(); }
function evaluateCV(text){
    let score=Math.floor(Math.random()*10)+1; 
    let accept=score>=5;
    let strongestSkill="Problem Solving"; 
    let specialty=specialties[Math.floor(Math.random()*specialties.length)];
    return {score,accept,strongestSkill,specialty};
}
async function extractTextFromPDF(file){
    const arrayBuffer=await file.arrayBuffer();
    const pdf=await pdfjsLib.getDocument({data:arrayBuffer}).promise;
    let fullText="";
    for(let i=1;i<=pdf.numPages;i++){
        const page=await pdf.getPage(i);
        const txt=await page.getTextContent();
        fullText+=txt.items.map(t=>t.str).join(" ")+" ";
    }
    return fullText;
}
async function analyzeBatch(){
    const files=document.getElementById('pdfFiles').files;
    if(files.length===0){ alert("Select at least one PDF CV."); return;}
    document.getElementById('loader').style.display='block';
    document.getElementById('resultsCards').innerHTML="";
    results=[];
    for(const file of files){
        const text=await extractTextFromPDF(file);
        const res=evaluateCV(text);
        results.push({name:file.name,phone:"+96112345678",...res});
        const card=document.createElement('div'); card.className='card show';

        // ØµÙˆØ±Ø© Ø°ÙƒÙŠØ© (placeholder)
        const imgSrc="https://i.pravatar.cc/300?u="+encodeURIComponent(file.name);

        card.innerHTML=`
            <img src="${imgSrc}" alt="CV Photo">
            <h3>${file.name}</h3>
            <div class="info">Phone: +96112345678</div>
            <div class="info">Specialty: ${res.specialty}</div>
            <div class="info">Strongest Skill: ${res.strongestSkill}</div>
            <div class="info">Score: ${res.score}/10</div>
            <div class="status ${res.accept?'accept':'reject'}">${res.accept?'Accepted':'Rejected'}</div>
        `;
        document.getElementById('resultsCards').appendChild(card);
        playSound(res.accept?'accept':'reject');
        await new Promise(r=>setTimeout(r,400));
    }
    document.getElementById('loader').style.display='none';
    document.getElementById('downloadExcel').style.display='inline-block';
}

function downloadExcel(){
    const wb=XLSX.utils.book_new();
    const ws_data=[["Name","Phone","Specialty","Strongest Skill","Score","Status"]];
    results.forEach(r=>{ws_data.push([r.name,r.phone,r.specialty,r.strongestSkill,r.score,r.accept?'Accepted':'Rejected']);});
    const ws=XLSX.utils.aoa_to_sheet(ws_data);
    XLSX.utils.book_append_sheet(wb,ws,"Results");
    XLSX.writeFile(wb,"CV_Analysis.xlsx");
}
</script>
</body>
</html>
