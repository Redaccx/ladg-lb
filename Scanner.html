<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام الحضور برقم ID</title>

<style>
  body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f7; display:flex; flex-direction:column; align-items:center; padding:20px; min-height:100vh; margin:0;}
  h1 {color:#333; margin-bottom:20px;}
  #instruction { font-size:1.3em; margin:15px 0; padding:10px 20px; border-radius:10px; text-align:center; transition: all 0.3s ease; }
  .in-success { background-color:#d4edda; color:#155724; border:2px solid #155724; }
  .in-exit { background-color:#fff3cd; color:#856404; border:2px solid #856404; }
  .in-error { background-color:#f8d7da; color:#721c24; border:2px solid #721c24; }
  #result { font-size:1.5em; margin-top:10px; text-align:center; color:#222; }
  input { font-size:1.2em; padding:10px; border-radius:8px; border:1px solid #ccc; text-align:center; width:250px; }
</style>
</head>
<body>

<h1>نظام الحضور</h1>
<div id="instruction" class="in-success">أدخل رقم الـ ID</div>
<input type="text" id="user-id" placeholder="رقم ID" />
<div id="result"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, query, where, orderBy, limit, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// إعداد Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDVbS9U5qVC4DSk326d0ljW6ETGkyHVLUQ",
  authDomain: "ladg-attendance.firebaseapp.com",
  projectId: "ladg-attendance",
  storageBucket: "ladg-attendance.firebasestorage.app",
  messagingSenderId: "499991014945",
  appId: "1:499991014945:web:e4cd793de709191a157d60"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// قائمة المستخدمين
const users = {
  "123-456-7907": "Mais Salloum",
  "123-456-7905": "Waad Al-Ahmad",
  "123-456-7902": "Jomaa Al-Mohammad",
  "123-456-7901": "Hadi Jaafar",
  "123-456-7899": "Mohammad Jaafar",
  "123-456-7904": "Anwar Nemer",
  "123-456-7903": "Mohsen Youssef",
  "123-456-7897": "Elsy Abdul Sater",
  "123-456-7898": "Ghadir Mostafa",
  "123-456-8965": "Jihad al ali",
  "123-456-8965": "Nida al ali",
  "123-456-8963": "Ali jaafar",
  "123-456-7891": "Rida Al-Jomaa",
  "123-456-7890": "Jackleen Jaafar",
  "123-456-7908": "Zahraa Zaiter"
};

const instructionEl = document.getElementById("instruction");
const resultEl = document.getElementById("result");
const inputEl = document.getElementById("user-id");

async function registerAttendance(code) {
  if(!users[code]){
    instructionEl.innerText = "⚠️ رقم ID غير معروف";
    instructionEl.className = "in-error";
    resultEl.innerText = code;
    return;
  }

  const name = users[code];
  const now = new Date();
  const date = now.toLocaleDateString("en-CA");
  const time = now.toLocaleTimeString();

  const q = query(
    collection(db, "attendance"),
    where("code", "==", code),
    where("date", "==", date),
    orderBy("timestamp","desc"),
    limit(1)
  );
  const qSnap = await getDocs(q);

  let status="دخول";
  let classStatus="in-success";
  if(!qSnap.empty && qSnap.docs[0].data().status==="دخول"){
    status="خروج";
    classStatus="in-exit";
  }

  await addDoc(collection(db, "attendance"), {
    code, name, date, time, status, timestamp: Date.now()
  });

  instructionEl.innerText=`✔️ تم تسجيل ${status}`;
  instructionEl.className = classStatus;
  resultEl.innerHTML=`${name}<br>${date} - ${time}`;
  inputEl.value = "";
}

// تسجيل عند الضغط على Enter
inputEl.addEventListener("keypress", e => {
  if(e.key === "Enter"){
    registerAttendance(inputEl.value.trim());
  }
});
</script>

</body>
</html>
