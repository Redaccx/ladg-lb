<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Attendance System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: "Segoe UI", Tahoma, sans-serif; background:#f4f6f9; margin:0; padding:0; text-align:center; overflow-x:hidden;}
header { background:#2c3e50; color:white; padding:15px; font-size:20px;}
main { padding:20px; max-width:1000px; margin:auto;}
input, select { padding:10px; width:220px; border:1px solid #ccc; border-radius:5px; margin-bottom:10px;}
button { padding:10px 18px; margin:5px; cursor:pointer; border:none; border-radius:5px; font-size:14px; transition:0.3s;}
button:hover{opacity:0.85;}
.in{background:#27ae60;color:white;}
.out{background:#e74c3c;color:white;}
.edit{background:#f1c40f;color:black;}
.delete{background:#7f8c8d;color:white;}
.excel{background:#2980b9;color:white;}
.login{background:#34495e;color:white;}
.logout{background:#8e44ad;color:white;}
.settings{background:#16a085;color:white;}
table{width:100%; border-collapse:collapse; margin-top:20px; background:white; box-shadow:0px 2px 6px rgba(0,0,0,0.1);}
th, td{border:1px solid #ddd; padding:12px; text-align:center; font-size:14px;}
th{background:#34495e;color:white;}
.status-hadir{color:#27ae60;font-weight:bold;}
.status-ghayeb{color:#e74c3c;font-weight:bold;}
#loginPage, #app{display:none;}
p.rights{margin-top:20px; font-size:12px; color:#555;}
p.rights a{color:#2980b9;text-decoration:none;}
.login-container{background:white; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.2); display:inline-block; margin-top:30px;}
.desc{font-size:14px; color:#555; margin-bottom:10px;}
.table-container{overflow-x:auto;}
@media (max-width:768px){input,select{width:100%;} button{width:100%;margin:5px 0;} table, th, td{font-size:12px;}}
</style>
</head>
<body>

<header>📋 Attendance System</header>

<!-- Login Page -->
<div id="loginPage">
  <div class="login-container">
    <h2>🔑 Login</h2>
    <div class="desc">Attendance System for Employees</div>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button class="login" onclick="login()">Login</button>
  </div>
</div>

<!-- App Page -->
<div id="app">
<main>
<button class="logout" onclick="logout()">🚪 Logout</button>

<div class="controls">
  <select id="employeeSelect"></select><br>
  <button class="in" onclick="checkIn()">Check In</button>
  <button class="out" onclick="checkOut()">Check Out</button>
  <button class="excel" onclick="exportExcel()">📊 Export Excel</button>
</div>

<div>
  <input type="text" id="searchBox" placeholder="🔍 Search by Name or ID" onkeyup="searchRecords()">
</div>

<h2>📑 Records</h2>
<div class="table-container">
<table id="attendanceTable">
<tr>
<th>ID</th><th>Name</th><th>Date</th><th>Check In</th><th>Check Out</th><th>Duration</th><th>Status</th><th>Actions</th>
</tr>
</table>
</div>

<p class="rights">© 2025 Developed by <a href="https://www.instagram.com/beweble" target="_blank">beweble</a></p>
</main>
</div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script>
// Login credentials
let savedUser = { username:"ladg", password:"ladg@$2025" };

// Employees list
let employees = [
  { id: "123-456-7907", name: "ميس السلوم" },
  { id: "123-456-7906", name: "علي جعفر" },
  { id: "123-456-7905", name: "وعد الأحمد" },
  { id: "123-456-7904", name: "أنور نمر" },
  { id: "123-456-7903", name: "محسن يوسف" },
  { id: "123-456-7902", name: "جمعة المحمد" },
  { id: "123-456-7901", name: "هادي جعفر" },
  { id: "123-456-7899", name: "محمد جعفر" },
  { id: "123-456-7898", name: "غدير مصطفى" },
  { id: "123-456-7897", name: "إلسي عبد الساتر" },
  { id: "123-456-7895", name: "نور نبها" },
  { id: "123-456-7894", name: "جاد نبها" },
  { id: "123-456-7892", name: "هادي عبد الساتر" },
  { id: "123-456-7891", name: "رضا الجمعة" }
];

// Auto login
if(localStorage.getItem("loggedIn")==="true"){
  document.getElementById("loginPage").style.display="none";
  document.getElementById("app").style.display="block";
  loadEmployees();
  loadData();
}else{
  document.getElementById("loginPage").style.display="block";
}

// Login function
function login(){
  const username=document.getElementById("username").value.trim();
  const password=document.getElementById("password").value.trim();
  if(username===savedUser.username && password===savedUser.password){
    localStorage.setItem("loggedIn","true");
    document.getElementById("loginPage").style.display="none";
    document.getElementById("app").style.display="block";
    loadEmployees();
    loadData();
  } else alert("⚠️ Incorrect username or password");
}

// Logout
function logout(){
  localStorage.removeItem("loggedIn");
  document.getElementById("app").style.display="none";
  document.getElementById("loginPage").style.display="block";
}

// Load employees in dropdown
function loadEmployees(){
  const sel = document.getElementById("employeeSelect");
  sel.innerHTML="";
  employees.forEach(emp=>{
    const opt=document.createElement("option");
    opt.value=emp.id;
    opt.textContent=`${emp.id} - ${emp.name}`;
    sel.appendChild(opt);
  });
}

// Format date
function formatDate(dateStr){
  const d=new Date(dateStr);
  return `${String(d.getDate()).padStart(2,"0")}/${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`;
}

// Format duration
function formatDuration(cIn,cOut){
  const diff=new Date(cOut)-new Date(cIn);
  const total=Math.floor(diff/60000);
  return `${Math.floor(total/60)}h ${total%60}m`;
}

// Load attendance data
function loadData(){
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  const table=document.getElementById("attendanceTable");
  table.innerHTML=`<tr><th>ID</th><th>Name</th><th>Date</th><th>Check In</th><th>Check Out</th><th>Duration</th><th>Status</th><th>Actions</th></tr>`;
  records.forEach((r,i)=>{
    const row=table.insertRow();
    row.insertCell(0).innerText=r.id;
    row.insertCell(1).innerText=r.name;
    row.insertCell(2).innerText=formatDate(r.date);
    row.insertCell(3).innerText=new Date(r.checkin).toLocaleTimeString("en-GB");
    row.insertCell(4).innerText=r.checkout?new Date(r.checkout).toLocaleTimeString("en-GB"):"-";
    row.insertCell(5).innerText=r.checkout?formatDuration(r.checkin,r.checkout):"-";
    const st=row.insertCell(6);
    st.innerText=r.status||"-";
    st.className=r.status==="حاضر"?"status-hadir":"status-ghayeb";
    const act=row.insertCell(7);
    act.innerHTML=`<button class="edit" onclick="editRecord(${i})">Edit</button>
                   <button class="delete" onclick="deleteRecord(${i})">Delete</button>
                   <button class="in" onclick="toggleStatus(${i})">Toggle</button>`;
  });
}

// Check In
function checkIn(){
  const id=document.getElementById("employeeSelect").value;
  const emp=employees.find(e=>e.id===id);
  const now=new Date();
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  records.push({id:emp.id,name:emp.name,date:now.toISOString(),checkin:now.toISOString(),checkout:null,status:"حاضر"});
  localStorage.setItem("attendance",JSON.stringify(records));
  loadData();
}

// Check Out
function checkOut(){
  const id=document.getElementById("employeeSelect").value;
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  const rec=[...records].reverse().find(r=>r.id===id && !r.checkout);
  if(rec){ rec.checkout=new Date().toISOString(); localStorage.setItem("attendance",JSON.stringify(records)); loadData();}
  else alert("⚠️ الموظف لم يسجل حضور بعد");
}

// Toggle Status
function toggleStatus(i){const records=JSON.parse(localStorage.getItem("attendance")||"[]");records[i].status=records[i].status==="حاضر"?"غائب":"حاضر";localStorage.setItem("attendance",JSON.stringify(records));loadData();}

// Edit Record
function editRecord(i){
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");const r=records[i];
  let newDate=prompt("📅 Enter Date (YYYY-MM-DD):",r.date.split("T")[0]);if(newDate){r.date=newDate+"T00:00:00";}
  let newIn=prompt("🕒 Enter Check-In (HH:MM:SS):",new Date(r.checkin).toLocaleTimeString("en-GB"));if(newIn){const d=new Date(r.date);const[h,m,s]=newIn.split(":");d.setHours(h);d.setMinutes(m);d.setSeconds(s||0);r.checkin=d.toISOString();}
  let newOut=r.checkout?new Date(r.checkout).toLocaleTimeString("en-GB"):"";newOut=prompt("🕒 Enter Check-Out (HH:MM:SS):",newOut);if(newOut){const d=new Date(r.date);const[h,m,s]=newOut.split(":");d.setHours(h);d.setMinutes(m);d.setSeconds(s||0);r.checkout=d.toISOString();}
  localStorage.setItem("attendance",JSON.stringify(records));loadData();
}

// Delete
function deleteRecord(i){if(!confirm("⚠️ Delete record?"))return;const records=JSON.parse(localStorage.getItem("attendance")||"[]");records.splice(i,1);localStorage.setItem("attendance",JSON.stringify(records));loadData();}

// Export Excel
function exportExcel(){
  const records=JSON.parse(localStorage.getItem("attendance")||"[]");
  const data=records.map(r=>({ID:r.id,Name:r.name,Date:formatDate(r.date),"Check In":new Date(r.checkin).toLocaleTimeString("en-GB"),"Check Out":r.checkout?new Date(r.checkout).toLocaleTimeString("en-GB"):"-",Duration:r.checkout?formatDuration(r.checkin,r.checkout):"-",Status:r.status}));
  const ws=XLSX.utils.json_to_sheet(data);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Records");XLSX.writeFile(wb,"attendance.xlsx");
}

// Search
function searchRecords(){
  const q=document.getElementById("searchBox").value.toLowerCase();
  const table=document.getElementById("attendanceTable");const tr=table.getElementsByTagName("tr");
  for(let i=1;i<tr.length;i++){let td0=tr[i].getElementsByTagName("td")[0];let td1=tr[i].getElementsByTagName("td")[1];
    if(td0&&td1){let txt=(td0.textContent+td1.textContent).toLowerCase();tr[i].style.display=txt.includes(q)?"":"none";}
  }
}
</script>
</body>
</html>
