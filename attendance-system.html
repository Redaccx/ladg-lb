<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: "Segoe UI", Tahoma, sans-serif; background: #f4f6f9; margin:0; padding:0; text-align:center;}
  header { background:#2c3e50; color:white; padding:15px; font-size:20px;}
  main { padding:20px; max-width:1000px; margin:auto;}
  input { padding:10px; width:220px; border:1px solid #ccc; border-radius:5px;}
  button { padding:10px 18px; margin:5px; cursor:pointer; border:none; border-radius:5px; font-size:14px; transition:0.3s;}
  button:hover{opacity:0.85;}
  .in{background:#27ae60;color:white;}
  .out{background:#e74c3c;color:white;}
  .edit{background:#f1c40f;color:black;}
  .delete{background:#7f8c8d;color:white;}
  .excel{background:#2980b9;color:white;}
  .login{background:#34495e;color:white;}
  .logout{background:#8e44ad;color:white;}
  table{width:100%; border-collapse:collapse; margin-top:20px; background:white; box-shadow:0px 2px 6px rgba(0,0,0,0.1);}
  th, td{border:1px solid #ddd; padding:12px; text-align:center; font-size:14px;}
  th{background:#34495e;color:white;}
  @media (max-width:768px){input{width:100%;margin-bottom:10px;} button{width:100%;margin:5px 0;} table, th, td{font-size:12px;}}
  #loginPage{display:none;} #app{display:none;}
</style>
</head>
<body>
<header>üìã Attendance System</header>

<!-- Login Page -->
<div id="loginPage">
<h2>üîë Login</h2>
<input type="text" id="username" placeholder="Username"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>
<button class="login" onclick="login()">Login</button>
</div>

<!-- App Page -->
<div id="app">
<main>
<button class="logout" onclick="logout()">üö™ Logout</button>
<div class="controls">
<input type="text" id="name" placeholder="Enter Employee Name"><br>
<button class="in" onclick="checkIn()">Check In</button>
<button class="out" onclick="checkOut()">Check Out</button>
<button class="excel" onclick="exportExcel()">üìä Export Excel</button>
</div>

<h2>üìë Records</h2>
<table id="attendanceTable">
<tr><th>Name</th><th>Date</th><th>Check In</th><th>Check Out</th><th>Duration</th><th>Actions</th></tr>
</table>
</main>
</div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script>
// Login Data
const savedUser = { username:"admin", password:"alanmaa@$2025" };
document.getElementById("loginPage").style.display="block";

// Login Function
function login(){
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  if(username===savedUser.username && password===savedUser.password){
    document.getElementById("loginPage").style.display="none";
    document.getElementById("app").style.display="block";
    loadData();
  } else alert("‚ö†Ô∏è Incorrect username or password");
}

// Logout Function
function logout(){
  document.getElementById("app").style.display="none";
  document.getElementById("loginPage").style.display="block";
  document.getElementById("username").value="";
  document.getElementById("password").value="";
}

// Format Duration (Hours & Minutes)
function formatDuration(checkin, checkout){
  const diff = new Date(checkout) - new Date(checkin);
  const totalMinutes = Math.floor(diff / 1000 / 60);
  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;
  return `${hours}h ${minutes}m`;
}

// Load Records
function loadData(){
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const table = document.getElementById("attendanceTable");
  table.innerHTML=`<tr><th>Name</th><th>Date</th><th>Check In</th><th>Check Out</th><th>Duration</th><th>Actions</th></tr>`;
  records.forEach((r,i)=>{
    const row = table.insertRow();
    row.insertCell(0).innerText = r.name;
    row.insertCell(1).innerText = new Date(r.date).toLocaleDateString("en-GB");
    row.insertCell(2).innerText = new Date(r.checkin).toLocaleTimeString("en-GB");
    row.insertCell(3).innerText = r.checkout ? new Date(r.checkout).toLocaleTimeString("en-GB") : "-";
    row.insertCell(4).innerText = r.checkout ? formatDuration(r.checkin, r.checkout) : "-";
    const actions = row.insertCell(5);
    actions.innerHTML = `<button class="edit" onclick="editRecord(${i})">Edit</button>
                         <button class="delete" onclick="deleteRecord(${i})">Delete</button>`;
  });
}

// Check In
function checkIn(){
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("‚ö†Ô∏è Please enter employee name");
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const now = new Date();
  records.push({name, date: now.toISOString(), checkin: now.toISOString(), checkout:null});
  localStorage.setItem("attendance", JSON.stringify(records));
  loadData();
}

// Check Out
function checkOut(){
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("‚ö†Ô∏è Please enter employee name");
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const record = [...records].reverse().find(r=>r.name===name && !r.checkout);
  if(record){
    record.checkout = new Date().toISOString();
    localStorage.setItem("attendance", JSON.stringify(records));
    loadData();
  } else alert("‚ö†Ô∏è Employee has not checked in yet");
}

// Edit Check In & Check Out
function editRecord(index){
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const r = records[index];

  const newCheckIn = prompt("üïí Enter new Check-In time (HH:MM:SS):", new Date(r.checkin).toLocaleTimeString("en-GB"));
  if(newCheckIn){
    const dateObj = new Date(r.date);
    const [h,m,s] = newCheckIn.split(":").map(Number);
    dateObj.setHours(h); dateObj.setMinutes(m); dateObj.setSeconds(s || 0);
    r.checkin = dateObj.toISOString();
  }

  let newCheckOut = r.checkout ? new Date(r.checkout).toLocaleTimeString("en-GB") : "";
  newCheckOut = prompt("üïí Enter new Check-Out time (HH:MM:SS, leave empty if not yet):", newCheckOut);
  if(newCheckOut){
    const dateObjOut = new Date(r.date);
    const [h,m,s] = newCheckOut.split(":").map(Number);
    dateObjOut.setHours(h); dateObjOut.setMinutes(m); dateObjOut.setSeconds(s || 0);
    r.checkout = dateObjOut.toISOString();
  }

  localStorage.setItem("attendance", JSON.stringify(records));
  loadData();
}

// Delete Record
function deleteRecord(index){
  if(!confirm("‚ö†Ô∏è Are you sure you want to delete this record?")) return;
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  records.splice(index,1);
  localStorage.setItem("attendance", JSON.stringify(records));
  loadData();
}

// Export Excel
function exportExcel(){
  const records = JSON.parse(localStorage.getItem("attendance")||"[]");
  const data = records.map(r => ({
    "Name": r.name,
    "Date": new Date(r.date).toLocaleDateString("en-GB"),
    "Check In": new Date(r.checkin).toLocaleTimeString("en-GB"),
    "Check Out": r.checkout ? new Date(r.checkout).toLocaleTimeString("en-GB") : "-",
    "Duration": r.checkout ? formatDuration(r.checkin, r.checkout) : "-"
  }));
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Records");
  XLSX.writeFile(wb, "attendance.xlsx");
}
</script>
</body>
</html>
